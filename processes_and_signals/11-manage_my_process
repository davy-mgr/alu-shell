#!/usr/bin/env bash
# Ensure the script gets debug output for each step
set -x

if [ "$1" = "start" ]; then
    # Start the process in the background
    ./manage_my_process &
    
    # Capture the PID of the background process
    PID=$!
    echo "Process PID: $PID"
    
    # Save the PID to /var/run/my_process.pid
    echo $PID | sudo tee /var/run/my_process.pid > /dev/null
    
    echo "manage_my_process started"
    
elif [ "$1" = "stop" ]; then
    # Kill the process by matching the name
    pkill -f ./manage_my_process
    
    # Remove the PID file
    sudo rm -f /var/run/my_process.pid
    
    echo "manage_my_process stopped"
    
elif [ "$1" = "restart" ]; then
    # Stop the process if it's running
    pkill -f ./manage_my_process
    sudo rm -f /var/run/my_process.pid
    
    # Start the process again in the background
    ./manage_my_process &
    
    # Capture the new PID
    PID=$!
    echo "Process PID: $PID"
    
    # Save the new PID to the PID file
    echo $PID | sudo tee /var/run/my_process.pid > /dev/null
    
    echo "manage_my_process restarted"
    
else
    # If an invalid argument is provided, show usage
    echo "Usage: manage_my_process {start|stop|restart}"
fi

# Disable debug output after script finishes
set +x
